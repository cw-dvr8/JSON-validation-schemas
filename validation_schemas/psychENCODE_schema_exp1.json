{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id":"http://example.com/psychENCODE_schema.json",
  "title": "annotations",
  "description": "Validates PsychENCODE file annotations",
  "type": "object",
  "properties": {
    "consortium": {
      "$ref": "sageCommunity.json#/definitions/consortium"
    },
    "grant": {
      "$ref": "neuro.json#/definitions/grant"
    },
    "study": {
      "$ref": "neuro.json#/definitions/study"
    },
    "group": {
      "$ref": "sageCommunity.json#/definitions/group"
    },
    "investigatorName": {
      "$ref": "clinicalData.json#/definitions/investigatorName"
    },
    "individualID": {
      "$ref": "experimentalData.json#/definitions/individualID"
    },
    "individualIdSource": {
      "$ref": "experimentalData.json#/definitions/individualIdSource"
    },
    "species": {
      "$ref": "experimentalData.json#/definitions/species"
    },
    "reportedGender": {
      "$ref": "clinicalData.json#/definitions/reportedGender"
    },
    "postmortem": {
      "$ref": "clinicalData.json#/definitions/postmortem"
    },
    "sex": {
      "anyOf": [
        {"$ref": "experimentalData.json#/definitions/sex"},
        {"type": "null"}
      ]
    },
    "race": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/race"},
        {"type": "null"}
      ]
    },
    "raceDetail": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/raceDetail"},
        {"type": "null"}
      ]
    },
    "genotypeInferredAncestry": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/genotypeInferredAncestry"},
        {"type": "null"}
      ]
    },
    "IQ": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/IQ"},
        {"type": "null"}
      ]
    },
    "BMI": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/BMI"},
        {"type": "null"}
      ]
    },
    "primaryDiagnosis": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/primaryDiagnosis"},
        {"type": "null"}
      ]
    },
    "primaryDiagnosisDetail": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/primaryDiagnosisDetail"},
        {"type": "null"}
      ]
    },
    "otherDiagnosis": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/otherDiagnosis"},
        {"type": "null"}
      ]
    },
    "otherDiagnosisDetail": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/otherDiagnosisDetail"},
        {"type": "null"}
      ]
    },
    "familyHistory": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/familyHistory"},
        {"type": "null"}
      ]
    },
    "ageOnset": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/ageOnset"},
        {"type": "null"}
      ]
    },
    "neuropathDescription" : {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/neuropathDescription"},
        {"type": "null"}
      ]
    },
    "dementia": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/dementia"},
        {"type": "null"}
      ]
    },
    "CDR": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/CDR"},
        {"type": "null"}
      ]
    },
    "braak": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/braak"},
        {"type": "null"}
      ]
    },
    "otherMedicalDx": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/otherMedicalDx"},
        {"type": "null"}
      ]
    },
    "otherMedicalDetail": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/otherMedicalDetail"},
        {"type": "null"}
      ]
    },
    "deathAge": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/deathAge"},
        {"type": "null"}
      ]
    },
    "deathAgeUnits": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/deathAgeUnits"},
        {"type": "null"}
      ]
    },
    "causeDeath": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/causeDeath"},
        {"type": "null"}
      ]
    },
    "deathManner": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/deathManner"},
        {"type": "null"}
      ]
    },
    "postmortemTox": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/postmortemTox"},
        {"type": "null"}
      ]
    },
    "postmortemToxSource": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/postmortemToxSource"},
        {"type": "null"}
      ]
    },
    "medRecordTox": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/medRecordTox"},
        {"type": "null"}
      ]
    },
    "organ": {
      "$ref": "experimentalData.json#/definitions/organ"
    },
    "PMICertain": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/PMICertain"},
        {"type": "null"}
      ]
    },
    "PMI": {
      "anyOf": [
        {"$ref": "neuro.json#/definitions/PMI"},
        {"type": "null"}
      ]
    },
    "pH": {
      "anyOf": [
        {"$ref": "neuro.json#/definitions/pH"},
        {"type": "null"}
      ]
    },
    "organWeight": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/organWeight"},
        {"type": "null"}
      ]
    },
    "organRIN": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/organRIN"},
        {"type": "null"}
      ]
    },
    "yearAutopsy": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/yearAutopsy"},
        {"type": "null"}
      ]
    },
    "specimenID": {
      "$ref": "experimentalData.json#/definitions/specimenID"
    },
    "tissue": {
      "$ref": "experimentalData.json#/definitions/tissue"
    },
    "cellType": {
      "$ref": "experimentalData.json#/definitions/cellType"
    },
    "nucleicAcidSource": {
      "$ref": "ngs.json#/definitions/nucleicAcidSource"
    },
    "BrodmannArea": {
      "anyOf": [
        {"$ref": "neuro.json#/definitions/BrodmannArea"},
        {"type": "null"}
      ]
    },
    "reprogrammedCellType": {
      "$ref": "clinicalData.json#/definitions/reprogrammedCellType"
    },
    "terminalDifferentiationPoint": {
      "$ref": "experimentalData.json#/definitions/terminalDifferentiationPoint"
    },
    "passage": {
      "$ref": "clinicalData.json#/definitions/passage"
    },
    "assay": {
      "$ref": "experimentalData.json#/definitions/assay"
    },
    "assayTarget": {
      "anyOf": [
        {"$ref": "experimentalData.json#/definitions/assayTarget"},
        {"type": "null"}
      ]
    },
    "libraryID": {
      "$ref": "clinicalData.json#/definitions/libraryID"
    },
    "isStranded": {
      "$ref": "ngs.json#/definitions/isStranded"
    },
    "RIN": {
      "$ref": "clinicalData.json#/definitions/RIN"
    },
    "readStrandOrigin": {
      "anyOf": [
        {"$ref": "ngs.json#/definitions/readStrandOrigin"},
        {"type": "null"}
      ]
    },
    "readLength": {
      "$ref": "ngs.json#/definitions/readLength"
    },
    "platform": {
      "$ref": "experimentalData.json#/definitions/platform"
    },
    "runType": {
      "$ref": "ngs.json#/definitions/runType"
    },
    "libraryPrep": {
      "$ref": "ngs.json#/definitions/libraryPrep"
    },
    "libraryPreparationMethod": {
      "$ref": "ngs.json#/definitions/libraryPreparationMethod"
    },
    "fileFormat": {
      "$ref": "sageCommunity.json#/definitions/fileFormat"
    },
    "referenceSet": {
      "$ref": "curatedData.json#/definitions/referenceSet"
    },
    "readPair": {
      "$ref": "ngs.json#/definitions/readPair"
    },
    "rRNARate": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/rRNARate"},
        {"type": "null"}
      ]
    },
    "meanCoverage": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/meanCoverage"},
        {"type": "null"}
      ]
    },
    "meanGCContent": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/meanGCContent"},
        {"type": "null"}
      ]
    },
    "percentAligned": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/percentAligned"},
        {"type": "null"}
      ]
    },
    "totalReads": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/totalReads"},
        {"type": "null"}
      ]
    },
    "mappedReads": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/mappedReads"},
        {"type": "null"}
      ]
    },
    "FRiP": {
      "anyOf": [
        {"$ref": "clinicalData.json#/definitions/FRiP"},
        {"type": "null"}
      ]
    },
    "biologicalReplicate": {
      "$ref": "clinicalData.json#/definitions/biologicalReplicate"
    },
    "isogenicReplicate": {
      "$ref": "clinicalData.json#/definitions/isogenicReplicate"
    },
    "anisogenicReplicate": {
      "$ref": "clinicalData.json#/definitions/anisogenicReplicate"
    },
    "technicalReplicate": {
      "$ref": "clinicalData.json#/definitions/technicalReplicate"
    },
    "sequencingReplicate": {
      "$ref": "clinicalData.json#/definitions/sequencingReplicate"
    }
  },
  "required": [
    "consortium",
    "grant",
    "study",
    "group",
    "investigatorName",
    "individualID",
    "individualIdSource",
    "species",
    "reportedGender",
    "postmortem",
    "organ",
    "specimenID",
    "tissue",
    "cellType",
    "nucleicAcidSource",
    "reprogrammedCellType",
    "terminalDifferentiationPoint",
    "passage",
    "assay",
    "libraryID",
    "isStranded",
    "RIN",
    "readLength",
    "platform",
    "runType",
    "libraryPrep",
    "libraryPreparationMethod",
    "fileFormat",
    "referenceSet",
    "readPair",
    "biologicalReplicate",
    "isogenicReplicate",
    "anisogenicReplicate",
    "technicalReplicate",
    "sequencingReplicate"
  ],
  "allOf": [
    {
      "if": {
        "properties": {
          "species": {
            "const": "Human"
          }
        }
      },
      "then": {
        "required": ["sex", "race", "raceDetail", "genotypeInferredAncestry", "IQ", "BMI",
                     "primaryDiagnosis", "primaryDiagnosisDetail", "otherDiagnosis", "familyHistory",
                     "ageOnset", "neuropathDescription", "dementia", "otherMedicalDx"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
              "otherDiagnosis": {
                "not": {"const": "None"}
              }
            },
	    "required": ["otherDiagnosis"]
          }
        ]
      },
      "then": {
        "required": ["otherDiagnosisDetail"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
	      "dementia": {
                "const": "True"
              }
            },
            "required": ["dementia"]
          }
        ]
      },
      "then": {
        "required": ["CDR", "braak"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
	      "otherMedicalDx": {
                "not": {"const": "None"}
              }
            },
	    "required": ["otherMedicalDx"]
          }
        ]
      },
      "then": {
        "required": ["otherMedicalDetail"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
              "postmortem": {
                "const": "True"
              }
            },
	    "required": ["postmortem"]
          }
        ]
      },
      "then": {
        "required": ["deathAge", "deathAgeUnits", "causeDeath", "deathManner", "postmortemTox",
	             "postmortemToxSource", "medRecordTox"]
      }
    },
    {
      "if": {
        "properties": {
          "postmortem": {
            "const": "True"
          }
        }
      },
      "then": {
        "required": ["PMICertain", "PMI", "pH", "organWeight", "organRIN", "yearAutopsy"]
      }
    }, 
    {
      "if": {
        "properties": {
          "organ": {
            "const": "brain"
          }
        }
      },
      "then": {
        "required": ["BrodmannArea"]
      }
    }, 
    {
      "if": {
        "properties": {
          "assay": {
            "const": "ChIPSeq"
          }
        }
      },
      "then": {
        "required": ["assayTarget", "FRiP"]
      }
    },
    {
      "if": {
        "properties": {
          "assay": {
            "anyOf": [
              {"const": "rnaSeq"},
              {"const": "ATACSeq"}
            ]
          }
        }
      },
      "then": {
        "required": ["rRNARate", "meanCoverage", "meanGCContent"]
      }
    },
    {
      "if": {
        "properties": {
          "fileFormat": {
            "anyOf": [
              {"const": "bai"},
              {"const": "bam"}
            ]
          }
        }
      },
      "then": {
        "required": ["percentAligned", "totalReads", "mappedReads"]
      }
    }
  ]
}
