{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id":"http://example.com/psychENCODE_schema.json",
  "title": "annotations",
  "description": "Validates PsychENCODE file annotations",
  "type": "object",
  "properties": {
    "consortium": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/sageCommunity.json#/definitions/consortium"
    },
    "grant": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/neuro.json#/definitions/grant"
    },
    "study": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/neuro.json#/definitions/study"
    },
    "group": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/sageCommunity.json#/definitions/group"
    },
    "investigatorName": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/sageCommunity.json#/definitions/investigatorName"
    },
    "individualID": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/individualID"
    },
    "individualIdSource": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/individualIdSource"
    },
    "species": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/species"
    },
    "reportedGender": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/reportedGender"
    },
    "postmortem": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/postmortem"
    },
    "sexChromosome": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/sexChromosome"
    },
    "race": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/race"
    },
    "raceDetail": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/raceDetail"
    },
    "genotypeInferredAncestry": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/genotypeInferredAncestry"
    },
    "IQ": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/IQ"
    },
    "BMI": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/BMI"
    },
    "primaryDiagnosis": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/primaryDiagnosis"
    },
    "primaryDiagnosisDetail": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/primaryDiagnosisDetail"
    },
    "otherDiagnosis": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/otherDiagnosis"
    },
    "otherDiagnosisDetail": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/otherDiagnosisDetail"
    },
    "familyHistory": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/familyHistory"
    },
    "ageOnset": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/ageOnset"
    },
    "neuropathDescription" : {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/neuropathDescription"
    },
    "dementia": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/dementia"
    },
    "CDR": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/CDR"
    },
    "braak": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/braak"
    },
    "otherMedicalDx": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/otherMedicalDx"
    },
    "otherMedicalDetail": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/otherMedicalDetail"
    },
    "ageOfDeath": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/ageOfDeath"
    },
    "ageOfDeathUnits": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/ageOfDeathUnits"
    },
    "causeOfDeath": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/causeOfDeath"
    },
    "mannerOfDeath": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/mannerOfDeath"
    },
    "postmortemTox": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/postmortemTox"
    },
    "postmortemToxSource": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/postmortemToxSource"
    },
    "medRecordTox": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/medRecordTox"
    },
    "organ": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/organ"
    },
    "PMICertain": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/neuro.json#/definitions/PMICertain"
    },
    "PMI": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/neuro.json#/definitions/PMI"
    },
    "pH": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/neuro.json#/definitions/pH"
    },
    "organWeight": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/organWeight"
    },
    "organRIN": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/organRIN"
    },
    "yearAutopsy": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/clinicalData.json#/definitions/yearAutopsy"
    },
    "specimenID": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/specimenID"
    },
    "tissue": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/tissue"
    },
    "cellType": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/cellType"
    },
    "nucleicAcidSource": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/nucleicAcidSource"
    },
    "BrodmannArea": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/neuro.json#/definitions/BrodmannArea"
    },
    "reprogrammedCellType": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/reprogrammedCellType"
    },
    "terminalDifferentiationPoint": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/terminalDifferentiationPoint"
    },
    "passage": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/passage"
    },
    "assay": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/assay"
    },
    "assayTarget": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/assayTarget"
    },
    "libraryID": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/libraryID"
    },
    "isStranded": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/isStranded"
    },
    "RIN": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/RIN"
    },
    "readStrandOrigin": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/readStrandOrigin"
    },
    "readLength": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/readLength"
    },
    "platform": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/platform"
    },
    "runType": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/runType"
    },
    "libraryPrep": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/libraryPrep"
    },
    "libraryPreparationMethod": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/libraryPreparationMethod"
    },
    "rnaBatch": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/rnaBatch"
    },
    "libraryBatch": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/libraryBatch"
    },
    "sequencingBatch": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/sequencingBatch"
    },
    "transposaseBatch": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/transposaseBatch"
    },
    "pcrCycles": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/pcrCycles"
    },
    "histoneAntibody": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/histoneAntibody"
    },
    "antibodyAmount": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/antibodyAmount"
    },
    "chromatinAmount": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/experimentalData.json#/definitions/chromatinAmount"
    },
    "alignmentMethod": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/alignmentMethod"
    },
    "fileFormat": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/sageCommunity.json#/definitions/fileFormat"
    },
    "referenceSet": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/curatedData.json#/definitions/referenceSet"
    },
    "readPair": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/ngs.json#/definitions/readPair"
    },
    "rRNARate": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/rRNARate"
    },
    "meanCoverage": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/meanCoverage"
    },
    "meanGCContent": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/meanGCContent"
    },
    "percentAligned": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/percentAligned"
    },
    "totalReads": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/totalReads"
    },
    "mappedReads": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/mappedReads"
    },
    "FRiP": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/FRiP"
    },
    "biologicalReplicate": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/biologicalReplicate"
    },
    "isogenicReplicate": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/isogenicReplicate"
    },
    "anisogenicReplicate": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/anisogenicReplicate"
    },
    "technicalReplicate": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/technicalReplicate"
    },
    "sequencingReplicate": {
      "$ref": "https://raw.githubusercontent.com/cw-dvr8/JSON-validation-schemas/master/validation_schemas/reference_definitions/analysis.json#/definitions/sequencingReplicate"
    }
  },
  "required": [
    "consortium",
    "grant",
    "study",
    "group",
    "investigatorName",
    "individualID",
    "individualIdSource",
    "species",
    "reportedGender",
    "postmortem",
    "organ",
    "specimenID",
    "tissue",
    "cellType",
    "nucleicAcidSource",
    "reprogrammedCellType",
    "terminalDifferentiationPoint",
    "passage",
    "assay",
    "libraryID",
    "isStranded",
    "RIN",
    "readLength",
    "platform",
    "runType",
    "libraryPrep",
    "libraryPreparationMethod",
    "fileFormat",
    "referenceSet",
    "readPair",
    "biologicalReplicate",
    "isogenicReplicate",
    "anisogenicReplicate",
    "technicalReplicate",
    "sequencingReplicate"
  ],
  "allOf": [
    {
      "if": {
        "properties": {
          "species": {
            "const": "Human"
          }
        }
      },
      "then": {
        "required": ["sex", "race", "raceDetail", "genotypeInferredAncestry", "IQ", "BMI",
                     "primaryDiagnosis", "primaryDiagnosisDetail", "otherDiagnosis", "familyHistory",
                     "ageOnset", "neuropathDescription", "dementia", "otherMedicalDx"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
              "otherDiagnosis": {
                "not": {"const": "None"}
              }
            },
	    "required": ["otherDiagnosis"]
          }
        ]
      },
      "then": {
        "required": ["otherDiagnosisDetail"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
	      "dementia": {
                "const": "True"
              }
            },
            "required": ["dementia"]
          }
        ]
      },
      "then": {
        "required": ["CDR", "braak"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
	      "otherMedicalDx": {
                "not": {"const": "None"}
              }
            },
	    "required": ["otherMedicalDx"]
          }
        ]
      },
      "then": {
        "required": ["otherMedicalDetail"]
      }
    },
    {
      "if": {
        "allOf": [
          {
            "properties": {
              "species": {
                "const": "Human"
              },
              "postmortem": {
                "const": "True"
              }
            },
	    "required": ["postmortem"]
          }
        ]
      },
      "then": {
        "required": ["deathAge", "deathAgeUnits", "causeDeath", "deathManner", "postmortemTox",
	             "postmortemToxSource", "medRecordTox"]
      }
    },
    {
      "if": {
        "properties": {
          "postmortem": {
            "const": "True"
          }
        }
      },
      "then": {
        "required": ["PMICertain", "PMI", "pH", "organWeight", "organRIN", "yearAutopsy"]
      }
    }, 
    {
      "if": {
        "properties": {
          "organ": {
            "const": "brain"
          }
        }
      },
      "then": {
        "required": ["BrodmannArea"]
      }
    }, 
    {
      "if": {
        "properties": {
          "assay": {
            "const": "ChIPSeq"
          }
        }
      },
      "then": {
        "required": ["assayTarget", "FRiP"]
      }
    },
    {
      "if": {
        "properties": {
          "assay": {
            "anyOf": [
              {"const": "rnaSeq"},
              {"const": "ATACSeq"}
            ]
          }
        }
      },
      "then": {
        "required": ["rRNARate", "meanCoverage", "meanGCContent"]
      }
    },
    {
      "if": {
        "properties": {
          "fileFormat": {
            "anyOf": [
              {"const": "bai"},
              {"const": "bam"}
            ]
          }
        }
      },
      "then": {
        "required": ["percentAligned", "totalReads", "mappedReads"]
      }
    }
  ]
}
